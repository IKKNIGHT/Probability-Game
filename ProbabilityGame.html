<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Probability Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 0;
            padding: 20px;
            background-color: #e9ecef;
        }

        h1 {
            color: #343a40;
        }

        #points-display {
            font-size: 24px;
            margin-bottom: 20px;
        }

        #game-board {
            display: none;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin: 20px auto;
            width: 300px;
        }

        .action-button {
            padding: 10px 20px;
            margin: 10px auto;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.3s;
            display: block;
            width: 150px;
        }

        .hit-btn {
            background-color: #28a745;
            color: white;
        }

        .stand-btn {
            background-color: #ffc107;
            color: white;
        }

        .reset-btn {
            background-color: #dc3545;
            color: white;
        }

        .hit-btn:hover,
        .stand-btn:hover,
        .reset-btn:hover {
            transform: scale(1.05);
        }

        .hand {
            font-size: 24px;
            margin: 20px 0;
        }

        .card {
            width: 50px;
            height: 70px;
            margin: 5px;
            display: inline-block;
            background: #f8f9fa;
            border: 1px solid #343a40;
            border-radius: 5px;
            text-align: center;
            line-height: 70px;
            font-size: 24px;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .card:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        #lose-screen {
            display: none;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin: 20px auto;
            width: 300px;
        }

        #how-to-play {
            margin-top: 20px;
            display: none;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            width: 300px;
            margin: 0 auto;
        }

        footer {
            margin-top: 20px;
            font-size: 14px;
        }

        footer a {
            color: #007bff;
            text-decoration: none;
        }

        footer a:hover {
            text-decoration: underline;
        }
    </style>
</head>

<body>

    <h1>Probability Game</h1>
    <div id="points-display">Points: <span id="points">100</span></div>

    <div id="game-board">
        <h2>Dealer's Hand:</h2>
        <div id="dealer-hand" class="hand"></div>
        <h2>Your Hand:</h2>
        <div id="player-hand" class="hand"></div>
        <button class="action-button hit-btn" id="hit-button">Hit</button>
        <button class="action-button stand-btn" id="stand-button">Stand</button>
    </div>

    <div id="lose-screen">
        <h2 id="result-message">You Lose!</h2>
        <h3>Dealer's Hand:</h3>
        <div id="final-dealer-hand" class="hand"></div>
        <h3>Your Hand:</h3>
        <div id="final-player-hand" class="hand"></div>
        <p>Gambling can be addictive. Please play responsibly.</p>
        <button class="action-button reset-btn" id="reset-button">Reset Game</button>
    </div>

    <div id="start-screen">
        <button class="action-button reset-btn" id="start-button">Start Game</button>
        <button class="action-button reset-btn" id="how-to-play-button">How to Play</button>
    </div>

    <div id="how-to-play">
        <h2>How to Play</h2>
        <p>1. Click "Start Game" to begin.</p>
        <p>2. Click "Hit" to draw a card or "Stand" to hold your hand.</p>
        <p>3. Try to get as close to 21 as possible without going over.</p>
        <p>4. If you exceed 21, you lose.</p>
        <p>5. If you hit 21, you automatically win, regardless of the dealer's hand.</p>
        <p>6. If you win, your points will increase. Remember to play responsibly!</p>
    </div>

    <footer>
        <p>By <a href="https://github.com/IKKNIGHT/Probability-Game" target="_blank">Isaaq Khanooni</a></p>
    </footer>

    <script>
        let points = localStorage.getItem('points') ? parseInt(localStorage.getItem('points')) : 100; // Default starting points
        document.getElementById('points').innerText = points;

        let playerHand = [];
        let dealerHand = [];
        let lastCardDrawn = null; // Track the last card drawn

        document.getElementById('start-button').onclick = function () {
            startGame();
        };

        function startGame() {
            playerHand = [drawCard(), drawCard()];
            dealerHand = [drawCard(), drawCard()];

            updateHands();
            document.getElementById('game-board').style.display = 'block';
            document.getElementById('start-screen').style.display = 'none'; // Hide start screen
            document.getElementById('lose-screen').style.display = 'none'; // Ensure lose screen is hidden
        }

        function drawCard() {
            let card;
            do {
                card = Math.floor(Math.random() * 11) + 1; // Draw a card between 1 and 11
            } while (card === 11 && lastCardDrawn === 11); // Prevent drawing consecutive 11s

            lastCardDrawn = card; // Update last card drawn
            return card;
        }

        function updateHands() {
            document.getElementById('dealer-hand').innerHTML = dealerHand[0] + ' <span class="card">??</span>'; // Show dealer's first card
            document.getElementById('player-hand').innerHTML = playerHand.map(cardToHTML).join('');
        }

        function cardToHTML(card) {
            return `<div class="card">${card}</div>`;
        }

        document.getElementById('hit-button').onclick = function () {
            playerHand.push(drawCard());
            updatePlayerHand();
        };

        document.getElementById('stand-button').onclick = function () {
            dealerPlay();
        };

        function updatePlayerHand() {
            document.getElementById('player-hand').innerHTML = playerHand.map(cardToHTML).join('');
            const playerValue = getHandValue(playerHand);
            if (playerValue > 21) {
                endGame(false); // Player busts
            } else if (playerValue === 21) {
                endGame(true); // Player auto wins
            }
        }

        function dealerPlay() {
            // Dealer hits until their hand value is at least 16
            while (getHandValue(dealerHand) < 16) {
                dealerHand.push(drawCard());
            }
            endGame(determineOutcome());
        }

        function getHandValue(hand) {
            return hand.reduce((sum, card) => sum + card, 0);
        }

        function determineOutcome() {
            const playerValue = getHandValue(playerHand);
            const dealerValue = getHandValue(dealerHand);

            if (dealerValue > 21) {
                return true; // Player wins if dealer busts
            } else if (playerValue > 21) {
                return false; // Player loses if they bust
            } else if (playerValue === 21) {
                return true; // Player wins automatically
            } else if (playerValue === dealerValue) {
                return null; // Tie
            } else {
                return playerValue > dealerValue; // Player wins if higher
            }
        }

        function endGame(result) {
            document.getElementById('final-dealer-hand').innerHTML = dealerHand.map(cardToHTML).join(''); // Show full dealer's hand
            document.getElementById('final-player-hand').innerHTML = playerHand.map(cardToHTML).join(''); // Show player's hand
            document.getElementById('game-board').style.display = 'none';
            document.getElementById('lose-screen').style.display = 'block';

            if (result === true) {
                points += 20; // Win points
                document.getElementById('result-message').innerText = "You Win!";
            } else if (result === false) {
                points -= 10; // Lose points
                document.getElementById('result-message').innerText = "You Lose!";
            } else {
                document.getElementById('result-message').innerText = "It's a Tie!";
            }

            localStorage.setItem('points', points); // Save points in localStorage
            document.getElementById('points').innerText = points;

            // Ensure Start Game and How to Play buttons remain hidden
            document.getElementById('start-screen').style.display = 'none'; // Hide start screen
        }

        document.getElementById('reset-button').onclick = function () {
            // Reset only the game state, not the points
            playerHand = [];
            dealerHand = [];
            document.getElementById('lose-screen').style.display = 'none';
            document.getElementById('game-board').style.display = 'none';
            document.getElementById('start-screen').style.display = 'block'; // Show start screen
        };

        document.getElementById('how-to-play-button').onclick = function () {
            const howToPlay = document.getElementById('how-to-play');
            howToPlay.style.display = (howToPlay.style.display === 'none' || howToPlay.style.display === '') ? 'block' : 'none';
        };
    </script>
</body>

</html>
